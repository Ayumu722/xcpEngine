#!/usr/bin/env bash

###################################################################
#  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  #
###################################################################

###################################################################
# Script resets global settings
###################################################################

###################################################################
#    ✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡      #
# Check for existence of all global variables
###################################################################
exitFlag=0
envVars="XCPEDIR FSLDIR AFNI_PATH C3D_PATH ANTSPATH"
for v in ${envVars}
do
   if [[ -z ${!v} ]]
      then
      setVars="${setVars} ${v}"
      exitFlag=2
   fi
done
if (( ${exitFlag} > 0 ))
   then 
   dirVal=$(dirname $0)
   pushd ${dirVal} >>/dev/null
   dirVal=$(pwd)
   echo \
   "
   WARNING: GLOBAL VARIABLES NOT RESET.
   
   The following environmental variables are undefined:
   
   ${setVars}
   
   These variables must be defined in order to enable
   XCP functionality. Undefined variables may be reflective
   of uninstalled prerequisites or of missing definitions,
   for instance in ~/.bash_profile
   
   Please ensure that these variables are defined in
   accordance with the provided example:
   export XCPEDIR=${dirVal}
   "
   exit 2
fi

which R >/dev/null 2>&1
if (( $? > 0 ))
   then 
   echo \
   "
   WARNING: GLOBAL VARIABLES NOT RESET.
   
   R is not currently in $USER's "'$PATH'"
   
   R must be in the "'$PATH'" in order to enable XCP
   functionality.
   
   Please ensure that R is installed and can be executed
   from the command line.
   "
   exit 2
fi
###################################################################
# Done checking for variables
#    ✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡✡      #
###################################################################


###################################################################
# Write to the global variables file.
###################################################################
rm -rf ${XCPEDIR}/settings/global
echo \
"#!/usr/bin/env bash

###################################################################
#  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  ☭  #
###################################################################

###################################################################
# XCPEDIR stores a path to the top-level directory containing all
# of the ingredients necessary to configure and execute functional
# connectivity pipelines using the XCP Engine.
XCPEDIR=$(pwd)
###################################################################

###################################################################
# RPATH stores a path to the local installation of R. Dependencies
# may include:
#  * ANTsR
#  * pracma
#  * signal
#  * optparse
RPATH=$(which R)
###################################################################

###################################################################
# FSLDIR stores a path to the local installation of FSL.
FSLDIR=$(echo ${FSLDIR})
###################################################################

###################################################################
# ANTSPATH stores a path to the local installation of ANTs.
ANTSPATH=$(echo ${ANTSPATH})
###################################################################

###################################################################
# AFNI_PATH stores a path to the local installation of AFNI.
AFNI_PATH=$(echo ${AFNI_PATH})
###################################################################

###################################################################
# C3D_PATH stores a path to the local installation of C3D.
C3D_PATH=$(echo ${C3D_PATH})
###################################################################

###################################################################
# When subject-specific paths are generalised by utils/genpath,
# the value of KEEPNUM determines whether leading numeric values
# not matching subject identifiers are retained.
KEEPNUM=1
###################################################################

###################################################################
# The default value of the starting directory is stored here.
# Editing this will change where the XCP configuration script
# searches by default.
startdir=$(pwd)
###################################################################

###################################################################
# Outputs of modules may be prepended with an integer indicating
# their context in the pipeline. Set NUMOUT to 1 to enable this.
NUMOUT=0
###################################################################

###################################################################
# Design files and analysis names will be timestamped to the
# minute if TIMESTAMP is set to 1.
TIMESTAMP=1
###################################################################

###################################################################
# The default pipeline is stored here. Edit this to change the
# default pipeline.
pipeline=
###################################################################
" >> ${XCPEDIR}/settings/global

chmod 755 ${XCPEDIR}/settings/global
